<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gu√≠a de Biodiversidad - El Limonar</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; scroll-behavior: smooth; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .img-loading { background: #f3f4f6; position: relative; overflow: hidden; }
        .img-loading::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: loading 1.5s infinite;
        }
        @keyframes loading { from { transform: translateX(-100%); } to { transform: translateX(100%); } }
    </style>
</head>
<body class="bg-stone-50 text-stone-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CONFIGURACI√ìN DE APIS (LLAVE INYECTADA POR EL ENTORNO) ---
        const apiKey = ""; 
        const MODEL_GEN = "gemini-2.5-flash-preview-09-2025";
        const MODEL_TTS = "gemini-2.5-flash-preview-tts";

        const Icon = ({ name, className }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        // Funci√≥n de Reintento Exponencial para robustez en m√≥viles
        const fetchWithRetry = async (url, options, retries = 5, backoff = 1000) => {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (err) {
                if (retries <= 0) throw err;
                await new Promise(resolve => setTimeout(resolve, backoff));
                return fetchWithRetry(url, options, retries - 1, backoff * 2);
            }
        };

        const App = () => {
            const getImg = (id) => `https://lh3.googleusercontent.com/d/${id}`;

            const animals = [
                { id: 1, commonName: "Mono Aullador Rojo", scientificName: "Alouatta seniculus", category: "Primates", habitat: "Dosel de bosques tropicales", info: "Es el jardinero del bosque: dispersa semillas grandes que mantienen la diversidad arb√≥rea. Su aullido en El Limonar es un indicador de la salud del dosel. Protegerlo garantiza que el bosque siga creciendo y capturando carbono.", color: "bg-orange-700", image: getImg("1ZA0JsTaJUnbOplOdBqQKizEmGin1xMpH") },
                { id: 2, commonName: "Mono Marteja", scientificName: "Aotus lemurinus", category: "Primates", habitat: "Bosques maduros, nocturnos", info: "Al ser nocturno, act√∫a como un polinizador silencioso de flores que solo abren de noche. Su presencia en nuestra reserva indica que los corredores biol√≥gicos nocturnos est√°n intactos y libres de contaminaci√≥n lum√≠nica.", color: "bg-amber-900", image: getImg("1qoyIz0TLmrEo935n0VkqpLMpj2F-zcvs") },
                { id: 3, commonName: "Tuc√°n Pico Iris", scientificName: "Ramphastos sulfuratus", category: "Aves", habitat: "Tierras bajas y selva", info: "Vital para la regeneraci√≥n de √°rboles frutales. Al regurgitar semillas lejos de la planta madre, evita la competencia entre pl√°ntulas. Su cuidado en El Limonar es s√≠mbolo de un ecosistema vibrante y productivo.", color: "bg-emerald-600", image: getImg("1BmEOSSQ-GsXMAJYcZlmYZLmBA4cBp3uT") },
                { id: 4, commonName: "Guacamaya Bandera", scientificName: "Ara macao", category: "Aves", habitat: "Selvas h√∫medas", info: "Como especie sombrilla, su protecci√≥n ayuda a conservar cientos de otras especies. En El Limonar, su presencia mon√≥gama nos ense√±a sobre la estabilidad del h√°bitat y la importancia de los √°rboles altos para anidaci√≥n.", color: "bg-red-600", image: getImg("18Am6EdZcpS7rluz1ce0mq1qupCCUxU9q") },
                { id: 5, commonName: "Loro Cabeciazul", scientificName: "Pionus menstruus", category: "Aves", habitat: "Dosel tropical", info: "Regulador de poblaciones de semillas y frutos en el dosel. Su algarab√≠a es m√∫sica para nuestra reserva, record√°ndonos la necesidad de mantener bosques conectados para sus vuelos sociales diarios.", color: "bg-blue-600", image: getImg("1g9k43mkqOIk1p1ZTE1aRhJxOM4yLd6Cb") },
                { id: 6, commonName: "Guacamayo Severo", scientificName: "Ara severus", category: "Aves", habitat: "Bordes de selva", info: "Ayuda a la dispersi√≥n de palmas nativas. Su cuidado en El Limonar asegura que las especies de borde de bosque no desaparezcan, manteniendo el equilibrio entre las √°reas abiertas y la selva densa.", color: "bg-green-700", image: getImg("1zVAV-JBPPlVGHBZSrPIfIUnrol3h0B5B") },
                { id: 7, commonName: "Bobo Punteado", scientificName: "Hypnelus ruficollis", category: "Aves", habitat: "Bosques secos", info: "Controlador natural de insectos y peque√±os reptiles. Su paciencia para cazar nos indica que hay abundancia de micro-fauna en los estratos bajos del bosque de El Limonar.", color: "bg-amber-600", image: getImg("1YRYcPBOE7yqwBPphBq52HLebrBwHLF1n") },
                { id: 8, commonName: "Canario Criollo", scientificName: "Sicalis flaveola", category: "Aves", habitat: "Jardines", info: "Excelente dispersor de semillas de plantas bajas y gram√≠neas. Su canto matutino es un bioindicador de aire limpio y jardines libres de pesticidas qu√≠micos dentro del hotel.", color: "bg-yellow-400", image: getImg("1Y8j_tWbvD3xTvsY3oyG8lHU0ruEJzgHj") },
                { id: 9, commonName: "Carpintero Pechipunteado", scientificName: "Colaptes punctigula", category: "Aves", habitat: "√Åreas abiertas", info: "Arquitecto del bosque: crea nidos que luego son usados por otras aves y mam√≠feros peque√±os. Controla plagas de hormigas y termitas en los √°rboles, previniendo da√±os estructurales en la madera.", color: "bg-stone-700", image: getImg("1Gh640OI7EJG2C6yMmP0c6pQfv3enDxJm") },
                { id: 10, commonName: "Mosquerito Silb√≥n", scientificName: "Camptostoma obsoletum", category: "Aves", habitat: "Bordes de bosque", info: "Regulador incansable de poblaciones de insectos voladores. Su presencia garantiza que los jardines de El Limonar mantengan un equilibrio natural sin necesidad de intervenci√≥n humana.", color: "bg-stone-400", image: getImg("1d6V2JswnW46pZAn5CBjrHlAa5rTvoOAZ") },
                { id: 11, commonName: "Garza Azul", scientificName: "Egretta caerulea", category: "Aves", habitat: "Humedales", info: "Controladora clave de peces peque√±os e insectos acu√°ticos. Su presencia en nuestros cuerpos de agua es se√±al de que los humedales de la zona est√°n sanos y llenos de vida.", color: "bg-indigo-700", image: getImg("1fVsgu05agLC6lqLNg65_5o9SgfuzKO1n") },
                { id: 12, commonName: "Carpintero Real", scientificName: "Campephilus melanoleucos", category: "Aves", habitat: "Bosques", info: "Especie indicadora de bosques maduros. Su capacidad para taladrar madera dura ayuda a la descomposici√≥n de materia org√°nica, devolviendo nutrientes al suelo de El Limonar.", color: "bg-stone-600", image: getImg("1cMKnEtb6EsOHqsPVNM--43CIh1Y1iZf-") },
                { id: 13, commonName: "Gavil√°n Cienaguero", scientificName: "Busarellus nigricollis", category: "Aves", habitat: "Cerca de agua", info: "Depredador tope de sistemas acu√°ticos. Al cazar peces enfermos o sobrepoblados, mantiene la pureza y el equilibrio gen√©tico de las especies en nuestros r√≠os y ci√©nagas.", color: "bg-yellow-700", image: getImg("13PsJypK4SHk8gJC-5TxtfcuAmSTpOOim") },
                { id: 14, commonName: "Mart√≠n Pescador", scientificName: "Chloroceryle amazona", category: "Aves", habitat: "R√≠os", info: "Bioindicador de calidad de agua. Si lo ves pescando en El Limonar, significa que el agua no tiene contaminantes qu√≠micos que maten a los peces peque√±os.", color: "bg-teal-700", image: getImg("1wqmzOh2RbD2n2f2IrjbK8cxi0h6lyFE9") },
                { id: 15, commonName: "Gallito de Ci√©naga", scientificName: "Porphyrio martinica", category: "Aves", habitat: "Pantanos", info: "Sus movimientos sobre la vegetaci√≥n flotante ayudan a oxigenar la superficie del agua y a dispersar plantas acu√°ticas beneficiosas. Su cuidado protege la biodiversidad del pantano.", color: "bg-indigo-600", image: getImg("1SF3aa9jKRknXXVlgB620gAr3ghpFO41D") },
                { id: 16, commonName: "Garza Tigre", scientificName: "Tigrisoma lineatum", category: "Aves", habitat: "Bordes de r√≠os", info: "Maestra del camuflaje y controladora de anfibios y crust√°ceos. Su presencia sigilosa es vital para mantener la cadena tr√≥fica en las riberas que rodean nuestra reserva.", color: "bg-amber-700", image: getImg("19oYVUkpV75cxjDEmEY743GgA-Vlhcm1X") },
                { id: 17, commonName: "Garcita Estriada", scientificName: "Butorides striata", category: "Aves", habitat: "Quebradas", info: "Peque√±a guardiana de las corrientes de agua. Controla la poblaci√≥n de larvas de mosquitos y peque√±os invertebrados, mejorando la experiencia de los hu√©spedes en el sendero.", color: "bg-stone-500", image: getImg("1UmR4z4LRZ5fP6xMp9A0G02JZGD_thhLs") },
                { id: 18, commonName: "Monjita Cabeciamarilla", scientificName: "Chrysomus icterocephalus", category: "Aves", habitat: "Humedales", info: "Sus colonias son fundamentales para la dispersi√≥n de nutrientes entre el agua y la tierra. Son voces de alerta ante la presencia de depredadores, protegiendo a otras aves del hotel.", color: "bg-yellow-600", image: getImg("12zFl7hBOhOO4uAZSflgBzaQP6f5tRkv-") },
                { id: 19, commonName: "Hornero", scientificName: "Furnarius rufus", category: "Aves", habitat: "Jardines", info: "Al construir nidos de barro, utiliza y recicla materiales del suelo. Sus antiguos nidos sirven de refugio para muchas otras especies que no pueden construir los suyos.", color: "bg-orange-300", image: getImg("1HKGNhB055JBJ5H5n6nGHp88Yu_5Jzpee") },
                { id: 20, commonName: "Oso Hormiguero", scientificName: "Tamandua tetradactyla", category: "Mam√≠feros", habitat: "Suelos y √°rboles", info: "Ingeniero de suelos y protector de √°rboles. Al consumir miles de termitas, evita que estas acaben con los √°rboles debilitados. Su cuidado en El Limonar protege la estructura misma del bosque.", color: "bg-amber-800", image: getImg("10ZDVYkH3mNZx_FIoCWTFEEH5YtiXWVFZ") },
                { id: 21, commonName: "Ardilla de Cola Roja", scientificName: "Sciurus granatensis", category: "Mam√≠feros", habitat: "Jardines", info: "La reforestadora m√°s eficiente de El Limonar. Al enterrar nueces y olvidarlas, permite que nuevos √°rboles crezcan lejos de sus padres, diversificando la gen√©tica de nuestro bosque.", color: "bg-orange-900", image: getImg("1cyQq43aizGJPcQ8s_KT6lP40nhbfGyPK") },
                { id: 22, commonName: "Iguana Verde", scientificName: "Iguana iguana", category: "Reptiles", habitat: "Cerca de agua", info: "Importante dispersora de semillas de plantas herb√°ceas y arbustos. Su presencia cerca de las fuentes de agua nos indica un equilibrio t√©rmico saludable en la zona del hotel.", color: "bg-lime-700", image: getImg("1Q8E7PFNt8FQkuqlXHp_Jr8YnymLdiBK4") },
                { id: 23, commonName: "Lagarto Overo", scientificName: "Tupinambis teguixin", category: "Reptiles", habitat: "Suelos", info: "Controlador biol√≥gico de caracoles, insectos e incluso serpientes peque√±as. Es un eslab√≥n fundamental que mantiene la limpieza biol√≥gica de los senderos bajos de nuestra reserva.", color: "bg-zinc-800", image: getImg("1nZLlu7X8JR6cmzVt89Z5H4ySHoDsFc4F") },
                { id: 24, commonName: "Tortuga Hicotea", scientificName: "Trachemys callirostris", category: "Reptiles", habitat: "Estanques", info: "Ayuda a mantener la transparencia de los estanques al consumir materia org√°nica en exceso. Su cuidado es un compromiso con la pureza de nuestros espejos de agua.", color: "bg-emerald-900", image: getImg("1Xq1K3APozzgBjCz-cV-rmup5rjMqqAfM") },
                { id: 25, commonName: "Tortuga Morrocoy", scientificName: "Chelonoidis carbonarius", category: "Reptiles", habitat: "Bosque seco", info: "Vital para el bosque seco de El Limonar. Al comer frutas ca√≠das, dispersa semillas con una alta tasa de germinaci√≥n gracias a su proceso digestivo lento.", color: "bg-orange-900", image: getImg("1UuGunzSRgT_zWhv4IHB7127Xsq91EKeW") },
                { id: 26, commonName: "Ranita de Lluvia", scientificName: "Pristimantis sp.", category: "Anfibios", habitat: "Hojarasca", info: "Indicadora de humedad y pureza del aire. Como respira a trav√©s de su piel, su presencia confirma que El Limonar est√° libre de contaminantes atmosf√©ricos t√≥xicos.", color: "bg-lime-600", image: getImg("1rtEh_QSEMCEHwx_YU0opmUDiLtgcc3jJ") },
                { id: 27, commonName: "Rana de Cristal", scientificName: "Nymphargus griffithsi", category: "Anfibios", habitat: "Bordes de agua", info: "Bioindicadora cr√≠tica. Su piel transparente la hace sensible a la m√°s m√≠nima contaminaci√≥n del agua. Protegerla es proteger el nacimiento de nuestras quebradas.", color: "bg-emerald-400", image: getImg("1OYrdh2RnWE2X5wGhYZhr1YX9CYP0gP1X") },
                { id: 28, commonName: "Mariposa Monarca", scientificName: "Danaus plexippus", category: "Insectos", habitat: "Jardines", info: "Polinizadora migratoria que conecta ecosistemas distantes. Su presencia en nuestros jardines asegura la reproducci√≥n de la flora nativa que alimenta a otros animales.", color: "bg-orange-500", image: getImg("1dQQiwctr_DZkEAZ0wWhYm44cqGrJ2HUv") },
                { id: 29, commonName: "Mariposa Amarilla", scientificName: "Phoebis sennae", category: "Insectos", habitat: "Flores", info: "Asegura la biodiversidad floral de El Limonar. Es una pieza clave para que los arbustos de flores silvestres sigan produciendo frutos para las aves peque√±as.", color: "bg-yellow-500", image: getImg("1ZI37v5J0HuWZ_detOWBB_e2o4xBY5TQ0") },
                { id: 30, commonName: "Mariposa Malaquita", scientificName: "Siproeta stelenes", category: "Insectos", habitat: "Sombras", info: "Especialista en polinizaci√≥n de plantas de sombra. Su belleza es un recordatorio de que cada rinc√≥n oscuro del bosque de El Limonar tiene una funci√≥n vital.", color: "bg-lime-500", image: getImg("1EXwtFxf8V2XgO8csJAQnyl6W74PX_YOp") }
            ];

            const [filter, setFilter] = useState('Todos');
            const [selectedAnimal, setSelectedAnimal] = useState(null);
            const [checkedAnimals, setCheckedAnimals] = useState({});
            const [isChatOpen, setIsChatOpen] = useState(false);
            const [chatMessages, setChatMessages] = useState([{ role: 'ai', text: '¬°Hola! Soy tu asistente de EL LIMONAR. ¬øQu√© especie encontraste hoy? üåø' }]);
            const [userInput, setUserInput] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [isIdentifying, setIsIdentifying] = useState(false);
            const [audioUrl, setAudioUrl] = useState(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const audioRef = useRef(null);

            const filteredAnimals = filter === 'Todos' ? animals : animals.filter(a => a.category === filter);

            // Control de Audio Centralizado
            useEffect(() => {
                if (audioUrl && isPlaying && audioRef.current) {
                    audioRef.current.play().catch(() => setIsPlaying(false));
                }
            }, [audioUrl, isPlaying]);

            // --- IDENTIFICADOR CON IA ‚ú® ---
            const handleImageUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsIdentifying(true);
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const base64 = reader.result.split(',')[1];
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_GEN}:generateContent?key=${apiKey}`;
                    const payload = {
                        contents: [{ role: "user", parts: [
                            { text: "Identifica este animal. Dame su nombre com√∫n, nombre cient√≠fico e importancia ecol√≥gica para El Limonar." },
                            { inlineData: { mimeType: "image/png", data: base64 } }
                        ]}]
                    };
                    try {
                        const data = await fetchWithRetry(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)});
                        const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "No logr√© identificarlo, ¬øpuedes intentar otra foto?";
                        setChatMessages(prev => [...prev, { role: 'ai', text: `üì∏ Resultado: ${text}` }]);
                        setIsChatOpen(true);
                    } catch (e) {
                        setChatMessages(prev => [...prev, { role: 'ai', text: "Error de conexi√≥n. Por favor verifica tu se√±al." }]);
                    } finally { setIsIdentifying(false); }
                };
            };

            // --- AUDIO GU√çA PROFESIONAL üîä ---
            const handleTTS = async (text) => {
                if (isPlaying) { audioRef.current?.pause(); setIsPlaying(false); return; }
                if (audioUrl) { setIsPlaying(true); return; }
                
                setIsGenerating(true);
                try {
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_TTS}:generateContent?key=${apiKey}`;
                    const payload = {
                        contents: [{ parts: [{ text: `Di con entusiasmo profesional: ${text}` }] }],
                        generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } } },
                        model: MODEL_TTS
                    };
                    const data = await fetchWithRetry(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)});
                    const pcmData = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                    
                    if (pcmData) {
                        const wavBlob = pcmToWav(pcmData, 24000);
                        setAudioUrl(URL.createObjectURL(wavBlob));
                        setIsPlaying(true);
                    }
                } catch (e) { console.error(e); } finally { setIsGenerating(false); }
            };

            const pcmToWav = (base64, sampleRate) => {
                const binary = atob(base64);
                const len = binary.length;
                const buffer = new ArrayBuffer(44 + len);
                const view = new DataView(buffer);
                const writeString = (offset, string) => { for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i)); };
                writeString(0, 'RIFF'); view.setUint32(4, 36 + len, true); writeString(8, 'WAVE'); writeString(12, 'fmt ');
                view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
                view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate * 2, true);
                view.setUint16(32, 2, true); view.setUint16(34, 16, true); writeString(36, 'data'); view.setUint32(40, len, true);
                for (let i = 0; i < len; i++) view.setUint8(44 + i, binary.charCodeAt(i));
                return new Blob([buffer], { type: 'audio/wav' });
            };

            return (
                <div className="min-h-screen pb-20">
                    <header className="h-[400px] bg-emerald-900 flex flex-col items-center justify-center text-white p-8 text-center relative overflow-hidden">
                        <div className="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1544947950-fa07a98d2ad7?auto=format')] bg-cover bg-center"></div>
                        <div className="relative z-10 flex flex-col items-center">
                            <img src="https://lh3.googleusercontent.com/d/1LNTkboFIGhJdPeAVw-08ffqZQP3cqIHm" alt="Logo" className="h-32 md:h-44 object-contain drop-shadow-2xl mb-4" />
                            <p className="text-emerald-100 italic tracking-[0.3em] uppercase text-[10px] font-bold opacity-90 mb-10">Biodiversidad El Limonar</p>
                            
                            <label className="flex items-center gap-3 bg-white text-emerald-950 px-10 py-5 rounded-3xl shadow-2xl cursor-pointer hover:scale-105 active:scale-95 transition-all font-black uppercase text-[11px] tracking-widest">
                                {isIdentifying ? <Icon name="loader-2" className="w-5 h-5 animate-spin" /> : <Icon name="camera" className="w-5 h-5" />}
                                Identificador IA ‚ú®
                                <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" capture="environment" />
                            </label>
                        </div>
                    </header>

                    <nav className="max-w-5xl mx-auto p-6 flex gap-3 overflow-x-auto hide-scrollbar sticky top-0 bg-stone-50/95 backdrop-blur-md z-40 border-b border-stone-100">
                        {["Todos", "Primates", "Aves", "Mam√≠feros", "Reptiles", "Anfibios", "Insectos"].map(cat => (
                            <button key={cat} onClick={() => setFilter(cat)} className={`whitespace-nowrap px-8 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${filter === cat ? 'bg-emerald-800 text-white shadow-xl' : 'bg-white text-stone-400 border border-stone-200'}`}>{cat}</button>
                        ))}
                    </nav>

                    <main className="max-w-6xl mx-auto px-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10 mt-10">
                        {filteredAnimals.map(animal => (
                            <div key={animal.id} className="bg-white rounded-[3rem] shadow-sm border border-stone-100 overflow-hidden flex flex-col hover:shadow-2xl transition-all group">
                                <div className="aspect-[4/3] relative bg-stone-100 overflow-hidden">
                                    <img src={animal.image} alt={animal.commonName} referrerpolicy="no-referrer" className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" />
                                    <div className={`absolute top-6 left-6 ${animal.color} text-white text-[8px] font-black px-4 py-1.5 rounded-xl uppercase tracking-widest`}>{animal.category}</div>
                                    <button 
                                        onClick={() => setCheckedAnimals(p => ({...p, [animal.id]: !p[animal.id]}))}
                                        className={`absolute top-6 right-6 p-4 rounded-full shadow-lg transition-all ${checkedAnimals[animal.id] ? 'bg-emerald-600 text-white scale-110' : 'bg-white/90 text-stone-300'}`}
                                    >
                                        <Icon name="check-circle" className="w-6 h-6" />
                                    </button>
                                </div>
                                <div className="p-10 flex-1 flex flex-col">
                                    <h3 className="text-2xl font-black text-stone-800 leading-tight mb-1">{animal.commonName}</h3>
                                    <p className="text-sm italic text-emerald-700/50 mb-8 font-serif">{animal.scientificName}</p>
                                    <button onClick={() => { setSelectedAnimal(animal); setAudioUrl(null); setIsPlaying(false); }} className="mt-auto w-full py-5 bg-stone-900 text-white rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest hover:bg-emerald-800 transition-colors">Ver Detalles ‚ú®</button>
                                </div>
                            </div>
                        ))}
                    </main>

                    {selectedAnimal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/98 p-4" onClick={() => setSelectedAnimal(null)}>
                            <div className="bg-white w-full max-w-4xl rounded-[4rem] overflow-hidden flex flex-col md:flex-row shadow-2xl relative max-h-[92vh]" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setSelectedAnimal(null)} className="absolute top-8 right-8 z-30 bg-stone-100/50 p-3 rounded-full hover:bg-white transition-all"><Icon name="x" className="w-6 h-6" /></button>
                                <div className="w-full md:w-1/2 h-72 md:h-auto bg-stone-100"><img src={selectedAnimal.image} className="w-full h-full object-cover" referrerpolicy="no-referrer" /></div>
                                <div className="p-10 md:p-14 md:w-1/2 flex flex-col overflow-y-auto">
                                    <span className="text-emerald-600 font-black text-[10px] uppercase tracking-widest mb-4 block">Historia Natural y Conservaci√≥n</span>
                                    <h2 className="text-5xl font-black text-stone-900 mb-2 leading-none">{selectedAnimal.commonName}</h2>
                                    <p className="text-xl italic text-stone-400 font-serif mb-10">{selectedAnimal.scientificName}</p>
                                    
                                    <button 
                                        onClick={() => handleTTS(selectedAnimal.info)}
                                        className="w-full py-6 bg-emerald-50 text-emerald-800 rounded-[2rem] font-black text-[11px] uppercase tracking-widest flex items-center justify-center gap-4 mb-10 hover:bg-emerald-100 active:scale-95 transition-all"
                                    >
                                        {isGenerating ? <Icon name="loader-2" className="w-6 h-6 animate-spin" /> : isPlaying ? <Icon name="pause" className="w-6 h-6" /> : <Icon name="volume-2" className="w-6 h-6" />}
                                        Audio Gu√≠a Profesional üîä
                                    </button>

                                    <div className="bg-stone-50 p-8 rounded-[2.5rem] border border-stone-100 mb-10">
                                        <p className="text-stone-700 leading-relaxed font-medium italic text-lg">"{selectedAnimal.info}"</p>
                                    </div>
                                    <div className="flex items-center gap-3 text-[10px] font-black uppercase text-stone-400 tracking-widest mt-auto"><Icon name="map-pin" className="w-5 h-5 text-emerald-500" /> H√°bitat: {selectedAnimal.habitat}</div>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className={`fixed bottom-8 right-8 z-[60] transition-all transform ${isChatOpen ? 'scale-100 opacity-100 translate-y-0' : 'scale-0 opacity-0 translate-y-10'}`}>
                        <div className="bg-white w-[350px] sm:w-[420px] h-[600px] rounded-[3.5rem] flex flex-col overflow-hidden border-8 border-emerald-950 shadow-2xl">
                            <div className="bg-emerald-950 p-8 flex justify-between items-center text-white">
                                <div>
                                    <span className="font-black text-xs uppercase tracking-widest block">Bi√≥logo Limonar</span>
                                    <span className="text-[8px] opacity-60 font-bold uppercase tracking-widest">Respuesta Inteligente ‚ú®</span>
                                </div>
                                <button onClick={() => setIsChatOpen(false)} className="p-2 bg-white/10 rounded-full hover:bg-white/20"><Icon name="x" className="w-5 h-5" /></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-8 space-y-6 bg-stone-50">
                                {chatMessages.map((msg, i) => (
                                    <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`p-5 rounded-[2rem] text-sm leading-relaxed ${msg.role === 'user' ? 'bg-emerald-700 text-white rounded-tr-none shadow-md' : 'bg-white text-stone-700 border border-stone-100 shadow-sm rounded-tl-none'}`}>{msg.text}</div>
                                    </div>
                                ))}
                                {isGenerating && <Icon name="loader-2" className="w-6 h-6 animate-spin text-emerald-800 mx-auto" />}
                            </div>
                            <form onSubmit={(e) => {
                                e.preventDefault();
                                if (!userInput.trim()) return;
                                setChatMessages(p => [...p, {role: 'user', text: userInput}]);
                                setUserInput('');
                            }} className="p-6 bg-white border-t flex gap-3">
                                <input value={userInput} onChange={(e) => setUserInput(e.target.value)} placeholder="¬øQu√© encontraste hoy?" className="flex-1 bg-stone-100 border-none rounded-2xl px-6 py-4 text-sm font-bold outline-none" />
                                <button type="submit" className="p-4 bg-emerald-800 text-white rounded-2xl"><Icon name="send" className="w-6 h-6" /></button>
                            </form>
                        </div>
                    </div>

                    {!isChatOpen && (
                        <button onClick={() => setIsChatOpen(true)} className="fixed bottom-10 right-10 w-20 h-20 bg-emerald-950 text-white rounded-full flex items-center justify-center shadow-2xl hover:scale-110 active:scale-95 transition-all z-[50] border-4 border-white">
                            <Icon name="message-circle" className="w-8 h-8" />
                        </button>
                    )}

                    {audioUrl && <audio ref={audioRef} src={audioUrl} onEnded={() => setIsPlaying(false)} className="hidden" />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
